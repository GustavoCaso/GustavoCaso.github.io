<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Building a CLI chat app with go and WebSockets &#183; Gustavo Caso</title><meta name=title content="Building a CLI chat app with go and WebSockets &#183; Gustavo Caso"><meta name=keywords content="go, WebSockets,"><link rel=canonical href=https://www.gustavocaso.dev/posts/building-a-cli-chat-app-with-go-and-websockets/><link type=text/css rel=stylesheet href=/css/main.bundle.min.c6116b9ed1c907a8c0eb015f377d3eecc07e448d75729e31fc3de5881465c6c172ba9fa9a6800c030116caf2a110d92242bb816639484ca791f7cd107a8d49b5.css integrity="sha512-xhFrntHJB6jA6wFfN30+7MB+RI11cp4x/D3liBRlxsFyup+ppoAMAwEWyvKhENkiQruBZjlITKeR980Qeo1JtQ=="><script type=text/javascript src=/js/appearance.min.0c2efa25b877bbb1cbe22c984957864f28de3072dda887632dd30d5e82bedd61a9cc3e2e996c81d9da4acbee3d4aee6b45d4a339fa66ee22f518123eb89a1b2a.js integrity="sha512-DC76Jbh3u7HL4iyYSVeGTyjeMHLdqIdjLdMNXoK+3WGpzD4umWyB2dpKy+49Su5rRdSjOfpm7iL1GBI+uJobKg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.911bd9741247c092f3a38757ca26b07e6bf319209e5162bbc5a609bae50fa2ea13b3c09f8f2c3d1cfd66c0b6885f0b2137bb43fee6404db177d90abde3c09547.js integrity="sha512-kRvZdBJHwJLzo4dXyiawfmvzGSCeUWK7xaYJuuUPouoTs8Cfjyw9HP1mwLaIXwshN7tD/uZATbF32Qq948CVRw==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Building a CLI chat app with go and WebSockets"><meta property="og:description" content="With the current global situation and the need to stay home, I decided to finish writing this post that I started during the last Christmas holidays."><meta property="og:type" content="article"><meta property="og:url" content="https://www.gustavocaso.dev/posts/building-a-cli-chat-app-with-go-and-websockets/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-14T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-14T00:00:00+00:00"><meta property="og:site_name" content="Gustavo Caso"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a CLI chat app with go and WebSockets"><meta name=twitter:description content="With the current global situation and the need to stay home, I decided to finish writing this post that I started during the last Christmas holidays."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building a CLI chat app with go and WebSockets","headline":"Building a CLI chat app with go and WebSockets","abstract":"With the current global situation and the need to stay home, I decided to finish writing this post that I started during the last Christmas holidays.","inLanguage":"en","url":"https:\/\/www.gustavocaso.dev\/posts\/building-a-cli-chat-app-with-go-and-websockets\/","author":{"@type":"Person","name":"Gustavo Caso"},"copyrightYear":"2020","dateCreated":"2020-03-14T00:00:00\u002b00:00","datePublished":"2020-03-14T00:00:00\u002b00:00","dateModified":"2020-03-14T00:00:00\u002b00:00","keywords":["go"," WebSockets"],"mainEntityOfPage":"true","wordCount":"1916"}]</script><meta name=author content="Gustavo Caso"><link href=mailto:gustavocaso@gmail.com rel=me><link href=https://github.com/GustavoCaso rel=me><link href=https://www.linkedin.com/in/gustavocaso/ rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Gustavo Caso</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12"><a href=/posts/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>Posts</p></a><a href=/tags/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Posts>Posts</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building a CLI chat app with go and WebSockets</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2020-03-14 00:00:00 +0000 UTC">14 March 2020</time><span class="px-2 text-primary-500">&#183;</span><span>1916 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/go/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">go</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/websockets/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WebSockets</span></span></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#lets-start-with-the-server>Let&rsquo;s start with the server:</a></li><li><a href=#lets-dive-into-the-client-side-of-the-cli-app>Let&rsquo;s dive into the client-side of the CLI app.</a></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#lets-start-with-the-server>Let&rsquo;s start with the server:</a></li><li><a href=#lets-dive-into-the-client-side-of-the-cli-app>Let&rsquo;s dive into the client-side of the CLI app.</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><p>With the current global situation and the need to stay home, I decided to finish writing this post that I started during the last Christmas holidays.</p><p>During Christmas, I wanted to learn more about the <a href=https://en.m.wikipedia.org/wiki/WebSocket target=_blank>WebSockets</a> protocol.</p><p>For that, I thought a simple chat app would be a good exercise.</p><p>I went on the internet and searched for tutorials on how to build a chat app using WebSockets and <a href=https://golang.org/ target=_blank>Go</a>, but I could not find any tutorial that showed a more realistic example. The majority of the samples were echo servers.</p><p>I wanted some examples that involved some user interaction.</p><p>I wanted to build something that resembles more a real chat like <a href=https://slack.com/ target=_blank>Slack</a>, <a href=https://www.whatsapp.com/ target=_blank>WhatsApp</a>, <a href=https://telegram.org/ target=_blank>Telegram</a>, etc.. There are many examples out there.</p><p>Full disclosure I&rsquo;m not a professional Go developer, but I&rsquo;m slowly learning for personal projects, and work.</p><p>Ok, let&rsquo;s start!!</p><p>First, we need to decide which WebSocket library to use, Go provides a WebSocket library, but the <a href=https://godoc.org/golang.org/x/net/websocket target=_blank>Go team advises</a> to use other solutions built by the community. You can even see a message when you want to read the doc for the library in GoDoc.</p><p>I decided to use <a href=https://github.com/nhooyr/websocket target=_blank>websocket</a> because it was the most recent of all and had support for context and rate-limiting.</p><p>Once we move away from deciding on the WebSocket library, we need a way to route request to our server, Go provides a fantastic <a href=https://godoc.org/net/http target=_blank>http</a> package for doing that. Still, often I find myself reaching for <a href=https://github.com/julienschmidt/httprouter target=_blank>another solution from the community to build the routes</a>. Not for any technical reason, but it was the first library I used to create a web app some time ago, and I&rsquo;m sticking with what I know and have worked for me.</p><p>Before we continue, I want to make clear that this post is not going to discuss goroutines synchronization, there is fantastic documentation on the <a href=https://golang.org/pkg/sync target=_blank>sync package</a> and tones of resources out there. So far, simplicity, I&rsquo;m going to remove those bits from the code examples.</p><p>Fantastic, we are ready to start building the CLI chat app.</p><p>So I want to divide the code between <code>server</code> and <code>client</code>.</p><p>The server handles new WebSocket connections, listen to messages on those socket connections and broadcast messages to the right users. Also, it takes care of adding and removing users to different chat rooms.</p><p>The client connects to the server, listens to messages that are sent to it and print them. It also allows the users to submit new messages to the server.</p><p>Those are going to be our two Go packages.</p><div id=lets-start-with-the-server class=anchor></div><h3 class="relative group">Let&rsquo;s start with the server:
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#lets-start-with-the-server aria-label=Anchor>#</a></span></h3><p>The server must provide an endpoint that clients can connect using the WebSocket protocol, for that we are going to use the <a href=https://godoc.org/net/http#Server target=_blank>Http.Server</a> abstraction that the Http package provides.</p><p>The handler is going to have a single route <code>/chat/:chat_room/:user_name</code>.</p><p>We have four abstractions: <code>Hub</code>, <code>Chat</code>, <code>Message</code> and <code>User</code>.</p><p>The <code>Hub</code> will hold a list of chats. You can think of the hub as a workspace in Slack; each workspace has different chat rooms.</p><p>When a user opens a WebSocket connection to <code>/chat/general/gustavo</code>, we are going to check if the chat <code>general</code> exists. If not, we will create it, store in the <code>Hub</code> and add gustavo to the list of users of that chat.
If the chat room exists, we will check if the user already is there and if not create a new user or return an error message if the user already exists.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>hub</span><span class=p>)</span> <span class=nf>chatRoom</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>,</span> <span class=nx>ps</span> <span class=nx>httprouter</span><span class=p>.</span><span class=nx>Params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>chatRoom</span> <span class=o>:=</span> <span class=nx>ps</span><span class=p>.</span><span class=nf>ByName</span><span class=p>(</span><span class=s>&#34;chat_room&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>userName</span> <span class=o>:=</span> <span class=nx>ps</span><span class=p>.</span><span class=nf>ByName</span><span class=p>(</span><span class=s>&#34;user_name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>c</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>h</span><span class=p>.</span><span class=nx>rooms</span><span class=p>[</span><span class=nx>chatRoom</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>:=</span> <span class=nx>h</span><span class=p>.</span><span class=nf>addChat</span><span class=p>(</span><span class=nx>chatRoom</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newUser</span><span class=p>(</span><span class=nx>userName</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>.</span><span class=nf>WithError</span><span class=p>(</span><span class=nx>err</span><span class=p>).</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Error creating user to new chat&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>addUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>.</span><span class=nf>hasUser</span><span class=p>(</span><span class=nx>userName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>.</span><span class=nf>WithFields</span><span class=p>(</span><span class=nx>log</span><span class=p>.</span><span class=nx>Fields</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;chat&#34;</span><span class=p>:</span>     <span class=nx>chatRoom</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;username&#34;</span><span class=p>:</span> <span class=nx>userName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;User already exists in chat room&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newUser</span><span class=p>(</span><span class=nx>userName</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>WithError</span><span class=p>(</span><span class=nx>err</span><span class=p>).</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Error creating user for chat&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nf>addUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The chat holds a list of users connected to that chat.
The most important thing that the chat does is acting as a coordinator between the multiple goroutines that will work to make listening, broadcasting and managing users possible.</p><p>Before we continue, we need to know what a user is. The user holds the name and the WebSocket connection for that particular user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>user</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>conn</span>      <span class=o>*</span><span class=nx>websocket</span><span class=p>.</span><span class=nx>Conn</span>
</span></span><span class=line><span class=cl>  <span class=nx>listening</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The user connection is an important detail because the chat uses those connections both for listening to messages and broadcasting messages to the right client.</p><p>Now that we know how the user and chat works let&rsquo;s dive into how we can listen, broadcast and keep the users updated for each chat.</p><p>Once we create a chat room, we are going to call the <code>run</code> function, which will start three different goroutines.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>chat</span><span class=p>)</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>listen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>broadcast</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>keepUserListUpdated</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>listen</code> goroutine, loops over all the users on the chat and creates another goroutine to listen to incoming messages. After receiving the message, we send it to the internal messages channel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>chat</span><span class=p>)</span> <span class=nf>listen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>users</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>user</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>!</span><span class=nx>user</span><span class=p>.</span><span class=nx>listening</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>user</span><span class=p>.</span><span class=nx>listening</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>          <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>listenToUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>chat</span><span class=p>)</span> <span class=nf>listenToUser</span><span class=p>(</span><span class=nx>user</span> <span class=o>*</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span><span class=p>,</span> <span class=nx>msg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>user</span><span class=p>.</span><span class=nx>conn</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nx>messages</span> <span class=o>&lt;-</span> <span class=nx>message</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bytes</span><span class=p>:</span>  <span class=nx>msg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>author</span><span class=p>:</span> <span class=nx>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nx>dropUsers</span> <span class=o>&lt;-</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It is essential to mention that if we get an error while listening to a message from a user, we are going to send a message to the <code>dropUsers</code> channel. We are going to use this channel on the <code>keepUserListUpdated</code> function.</p><p>Why do we need a separate goroutine per user? Great question. The act of listening for a message in the WebSocket connection is <a href=https://github.com/nhooyr/websocket/blob/c62c0dcc9318d1ad612613d433ec90d7c34378dc/ws_js.go#L99-L116 target=_blank>a blocking action.</a> So when iterating over the users, it will stop and wait for the first user to send a message, once the user has sent a message it will iterate to the next user and repeat the process.</p><p>If we do not create a different goroutine, we will listen to the messages in the order the users have connected to the chat. But we want to have a real-time experience when sending and receiving messages on our CLI chat app.</p><p>The <code>broadcast</code> goroutine listens on the <code>messages</code> channel, and every time we get a new message, we are going to send it to all the users except to the author of the message.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>chat</span><span class=p>)</span> <span class=nf>broadcast</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>loop</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>message</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>usersToSend</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>userToSend</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>author</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>bytes</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>message</span><span class=p>.</span><span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>user</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>usersToSend</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>user</span><span class=p>.</span><span class=nx>conn</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>websocket</span><span class=p>.</span><span class=nx>MessageText</span><span class=p>,</span> <span class=nx>bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>messagesRead</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>messagesRead</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>WithError</span><span class=p>(</span><span class=nx>err</span><span class=p>).</span><span class=nf>Warn</span><span class=p>(</span><span class=s>&#34;Error building the message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span> <span class=nx>loop</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, our last goroutine is the <code>keepUserListUpdated</code>, which takes care of adding and removing users on each chat.
We remove users from the chat every time there is an error reading from the WebSocket connection. You can check <code>listenToUser</code> above to see the logic that handles those cases.</p><p>Remember that previously we mentioned that when there is an error listening to users, we send a message to the <code>dropUsers</code> channel?</p><p>The <code>keepUserListUpdated</code> function listens to that channel, and every time a new message comes, it deletes the user from the list of active users in the chat.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>chat</span><span class=p>)</span> <span class=nf>keepUserListUpdated</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>loop</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>user</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>addedUsers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>users</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>users</span>
</span></span><span class=line><span class=cl>      <span class=nx>users</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>users</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>=</span> <span class=nx>users</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nf>broadcastMessage</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s joined %s\n&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>name</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>user</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>dropUsers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>users</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>deleteUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>=</span> <span class=nx>users</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span> <span class=nx>loop</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This function also takes care of adding users to the chat in a similar way, with the addition of broadcasting to all users that a new user joined the chat.</p><p>And that is all there is to the server package.</p><div id=lets-dive-into-the-client-side-of-the-cli-app class=anchor></div><h3 class="relative group">Let&rsquo;s dive into the client-side of the CLI app.
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#lets-dive-into-the-client-side-of-the-cli-app aria-label=Anchor>#</a></span></h3><p>The client functionality is to connect to the server, listen for new messages, print them and allow the users to send new messages to the server.</p><p>In our example, the client store the name of the user, a WebSocket connection to the server and a channel which we will use to send messages.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>client</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>userName</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>conn</span>     <span class=o>*</span><span class=nx>websocket</span><span class=p>.</span><span class=nx>Conn</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span>      <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span>
</span></span><span class=line><span class=cl>  <span class=nx>message</span>  <span class=kd>chan</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>When using the CLI as a client, we need to pass the chat room and the user who is connecting to it.</p><p><code>go run client/main.go --user_name=gustavo --chat_room=general</code></p><p>Executing that line will open a new connection to the server using the WebSocket protocol. <code>ws://localhost:8080/chat/general/gustavo</code>, notice that we haven&rsquo;t used <code>http</code> or <code>http</code> on the URL but rather <code>ws</code>.</p><p>All this logic is taking care of by the WebSocket library we are using.</p><p>Once the client has initialized, we are going to call the <code>run</code> method, which will start two new goroutines: <code>listen</code> and <code>getInput</code>.</p><p>The listen goroutine is very similar to the one on the server, but we do not have to loop over the different users since here we only have one user listening for messages.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>client</span><span class=p>)</span> <span class=nf>listen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span><span class=p>,</span> <span class=nx>reader</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>conn</span><span class=p>.</span><span class=nf>Reader</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>.</span><span class=nf>WithError</span><span class=p>(</span><span class=nx>err</span><span class=p>).</span><span class=nf>Warn</span><span class=p>(</span><span class=s>&#34;Error receiving message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>io</span><span class=p>.</span><span class=nf>Copy</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>reader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>What is that <code>io.Copy(os.Stdout, reader)</code> doing? It gets the message from the WebSocket and copies to the terminal <a href=https://www.howtogeek.com/435903/what-are-stdin-stdout-and-stderr-on-linux/ target=_blank>stdout.</a> Go provides the <a href=https://medium.com/@xeodou/understanding-golang-reader-writer-2c855eae0a94 target=_blank>Reader and Writer</a> abstractions that help us manipulate data between entities that implement the reader and writer <a href=https://gobyexample.com/interfaces target=_blank>interface.</a></p><p>The <code>getInput</code> function is a simple <a href=https://gobyexample.com/for target=_blank><code>for</code></a> loop that will listen for the user input coming from the terminal <a href=https://www.howtogeek.com/435903/what-are-stdin-stdout-and-stderr-on-linux/ target=_blank>stdin.</a>
Once we have a message from the user, we are going to send that message to the <code>message</code> channel of the client.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>client</span><span class=p>)</span> <span class=nf>getInput</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>in</span> <span class=o>:=</span> <span class=nx>bufio</span><span class=p>.</span><span class=nf>NewReader</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>in</span><span class=p>.</span><span class=nf>ReadString</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>.</span><span class=nf>WithError</span><span class=p>(</span><span class=nx>err</span><span class=p>).</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>c</span><span class=p>.</span><span class=nx>message</span> <span class=o>&lt;-</span> <span class=nx>result</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It makes sure that it is not empty since the user could use the return key, but haven&rsquo;t type anything, and we do not want to send blank messages to the server, that will get broadcast to all the users of the chat.</p><p>Finally, we have another <code>for</code> loop and <a href=https://gobyexample.com/select target=_blank><code>select</code></a> listening for messages on the <code>message</code> channel and every time we get a new message, we are going to write to the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>client</span><span class=p>)</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>listen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>go</span> <span class=nx>c</span><span class=p>.</span><span class=nf>getInput</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>loop</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>text</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>conn</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>websocket</span><span class=p>.</span><span class=nx>MessageText</span><span class=p>,</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span> <span class=nx>loop</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>.</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span> <span class=nx>loop</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>c</span><span class=p>.</span><span class=nb>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>And this is all that you need to create a CLI chat app with go and WebSockets.
I hope you enjoyed reading as much as I enjoyed writing the app and the article.
If you have any questions, please use the comments below, and I will answer them.</p><p>You can find all the code <a href=https://github.com/GustavoCaso/go-chat-websockets target=_blank>here</a></p><p>One last thing, I know the functionality is far from complete, but I haven&rsquo;t got the time to work more on it if you are curious and want to improve the app here a list of things you could work on:</p><ul><li>Broadcast all previous messages, when a new user connects to the chat.</li><li>Handle connection retry both on the server and the client.</li></ul></br></br></div><script>var oid="views_posts/building-a-cli-chat-app-with-go-and-websockets.md",oid_likes="likes_posts/building-a-cli-chat-app-with-go-and-websockets.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/when-open-source-has-less-benefits/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">When open source has less benefits</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2019-11-15 00:00:00 +0000 UTC">15 November 2019</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/writing-a-ractor-base-job-scheduler/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Writing a Ractor Base Job Scheduler</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2020-09-19 00:00:00 +0000 UTC">19 September 2020</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Gustavo Caso</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer></div></body></html>